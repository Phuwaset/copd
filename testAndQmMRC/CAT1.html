<!DOCTYPE html>
<html>

<head>
  <title>mmRC and CAT</title>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css2?family=Itim&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Itim', sans-serif;
    }

    body {
      background-image: linear-gradient(to right, rgba(59, 56, 241, 0.871), #bdb9f0);
    }

    .progress-bar {
      width: 50%;
      background-color: #007bff;
    }

    .progress {
      height: 1px;
      background-color: transparent;
      margin-bottom: 20px;
    }

    .form-check-group {
      align-items: center;
      margin: 20px 0;
    }

    .label-container {
      display: flex;
      align-items: center;
    }

    .form-check-input {
      margin: 0 5px;
    }

    .form-check-label {
      margin: 0 5px;
    }

    .container {
      padding: 20px;
    }

    .cat-group .form-check {
      margin-bottom: 20px;
    }

    .hidden-input {
      display: none;
    }

    @media (max-width: 970px) {
      .form-check-group {
        margin-bottom: 1rem;
      }

      .radio-group {
        align-items: flex-start;
      }

      .radio-group .form-check-label {
        margin-bottom: 0.5rem;
      }
    }
  </style>
</head>

<body class="inert">
  <div class="container">
    <div class="position-relative m-4">
      <div class="row">
        <div class="col-md-8 offset-md-2">
          <form id="myForm" class="mt-5 border p-3 bg-light shadow" style="border-radius: 20px;">
            <div class="row">
              <h3 class="mb-5 text-secondary text-center">
                <b>แบบประเมิน CAT (COPD)</b>
              </h3>
            </div>
            <center>
              <div class="row">
                <div class="mb-3 col">
                  <hr>
                  <b>
                    <p>MMRC (modified British Medical Research
                      Council)<br>ความรู้สึกเหนื่อยในการประกอบกิจกรรมในชีวิตประจำวัน</p>
                  </b>

                  <i>เลือกตัวเลือกที่ตรงกับผู้กรอกมากที่สุด*</i>

                  <hr>
                  <div class="container">
                    <div class="row cat-group">
                      <!-- Question 1 -->
                      <div class="col-md-12">
                        <div class="form-check-group">
                          <div class="label">
                            <label class="form-check-label">ข้าพเจ้าไม่เคยมีอาการไอ</label>
                          </div>
                          <div class="radio-group">
                            <input class="form-check-input" type="radio" name="question1" value="0" id="cat0">
                            <label class="form-check-label" for="cat0">0</label>
                            <input class="form-check-input" type="radio" name="question1" value="1" id="cat1">
                            <label class="form-check-label" for="cat1">1</label>
                            <input class="form-check-input" type="radio" name="question1" value="2" id="cat2">
                            <label class="form-check-label" for="cat2">2</label>
                            <input class="form-check-input" type="radio" name="question1" value="3" id="cat3">
                            <label class="form-check-label" for="cat3">3</label>
                            <input class="form-check-input" type="radio" name="question1" value="4" id="cat4">
                            <label class="form-check-label" for="cat4">4</label>
                            <input class="form-check-input" type="radio" name="question1" value="5" id="cat5">
                            <label class="form-check-label" for="cat5">5</label>
                          </div>
                        </div>
                      </div>
                      <!-- Question 2 -->
                      <div class="col-md-12">
                        <div class="form-check-group">
                          <div class="label">
                            <label class="form-check-label">ข้าพเจ้าไม่มีเสมหะในปอดเลย</label>
                          </div>
                          <div class="radio-group">
                            <input class="form-check-input" type="radio" name="question2" value="0" id="cat6">
                            <label class="form-check-label" for="cat6">0</label>
                            <input class="form-check-input" type="radio" name="question2" value="1" id="cat7">
                            <label class="form-check-label" for="cat7">1</label>
                            <input class="form-check-input" type="radio" name="question2" value="2" id="cat8">
                            <label class="form-check-label" for="cat8">2</label>
                            <input class="form-check-input" type="radio" name="question2" value="3" id="cat9">
                            <label class="form-check-label" for="cat9">3</label>
                            <input class="form-check-input" type="radio" name="question2" value="4" id="cat10">
                            <label class="form-check-label" for="cat10">4</label>
                            <input class="form-check-input" type="radio" name="question2" value="5" id="cat11">
                            <label class="form-check-label" for="cat11">5</label>
                          </div>
                        </div>
                      </div>
                      <!-- Question 3 -->
                      <div class="col-md-12">
                        <div class="form-check-group">
                          <div class="label">
                            <label class="form-check-label">ข้าพเจ้าไม่รู้สึกแน่นหน้าอกเลย</label>
                          </div>
                          <div class="radio-group">
                            <input class="form-check-input" type="radio" name="question3" value="0" id="cat12">
                            <label class="form-check-label" for="cat12">0</label>
                            <input class="form-check-input" type="radio" name="question3" value="1" id="cat13">
                            <label class="form-check-label" for="cat13">1</label>
                            <input class="form-check-input" type="radio" name="question3" value="2" id="cat14">
                            <label class="form-check-label" for="cat14">2</label>
                            <input class="form-check-input" type="radio" name="question3" value="3" id="cat15">
                            <label class="form-check-label" for="cat15">3</label>
                            <input class="form-check-input" type="radio" name="question3" value="4" id="cat16">
                            <label class="form-check-label" for="cat16">4</label>
                            <input class="form-check-input" type="radio" name="question3" value="5" id="cat17">
                            <label class="form-check-label" for="cat17">5</label>
                          </div>
                        </div>
                      </div>
                      <!-- Question 4 -->
                      <div class="col-md-12">
                        <div class="form-check-group">
                          <div class="label">
                            <label class="form-check-label">เมื่อข้าพเจ้าเดินขึ้นเนินหรือขึ้นบันไดหนึ่งชั้น
                              ข้าพเจ้ายังคงหายใจได้คล่อง</label>
                          </div>
                          <div class="radio-group">
                            <input class="form-check-input" type="radio" name="question4" value="0" id="cat18">
                            <label class="form-check-label" for="cat18">0</label>
                            <input class="form-check-input" type="radio" name="question4" value="1" id="cat19">
                            <label class="form-check-label" for="cat19">1</label>
                            <input class="form-check-input" type="radio" name="question4" value="2" id="cat20">
                            <label class="form-check-label" for="cat20">2</label>
                            <input class="form-check-input" type="radio" name="question4" value="3" id="cat21">
                            <label class="form-check-label" for="cat21">3</label>
                            <input class="form-check-input" type="radio" name="question4" value="4" id="cat22">
                            <label class="form-check-label" for="cat22">4</label>
                            <input class="form-check-input" type="radio" name="question4" value="5" id="cat23">
                            <label class="form-check-label" for="cat23">5</label>
                          </div>
                        </div>
                      </div>
                      <!-- Question 5 -->
                      <div class="col-md-12">
                        <div class="form-check-group">
                          <div class="label">
                            <label class="form-check-label">ข้าพเจ้าทำกิจกรรมต่างๆที่บ้านได้โดยไม่จำกัด </label>
                          </div>
                          <div class="radio-group">
                            <input class="form-check-input" type="radio" name="question5" value="0" id="cat24">
                            <label class="form-check-label" for="cat24">0</label>
                            <input class="form-check-input" type="radio" name="question5" value="1" id="cat25">
                            <label class="form-check-label" for="cat25">1</label>
                            <input class="form-check-input" type="radio" name="question5" value="2" id="cat26">
                            <label class="form-check-label" for="cat26">2</label>
                            <input class="form-check-input" type="radio" name="question5" value="3" id="cat27">
                            <label class="form-check-label" for="cat27">3</label>
                            <input class="form-check-input" type="radio" name="question5" value="4" id="cat28">
                            <label class="form-check-label" for="cat28">4</label>
                            <input class="form-check-input" type="radio" name="question5" value="5" id="cat29">
                            <label class="form-check-label" for="cat29">5</label>
                          </div>
                        </div>
                      </div>
                      <!-- Question 6 -->
                      <div class="col-md-12">
                        <div class="form-check-group">
                          <div class="label">
                            <label class="form-check-label">ข้าพเจ้ามีความมั่นใจที่จะออกไปนอกบ้านทั้งๆที่
                              ปอดข้าพเจ้ามีปัญหา</label>
                          </div>
                          <div class="radio-group">
                            <input class="form-check-input" type="radio" name="question6" value="0" id="cat30">
                            <label class="form-check-label" for="cat30">0</label>
                            <input class="form-check-input" type="radio" name="question6" value="1" id="cat31">
                            <label class="form-check-label" for="cat31">1</label>
                            <input class="form-check-input" type="radio" name="question6" value="2" id="cat32">
                            <label class="form-check-label" for="cat32">2</label>
                            <input class="form-check-input" type="radio" name="question6" value="3" id="cat33">
                            <label class="form-check-label" for="cat33">3</label>
                            <input class="form-check-input" type="radio" name="question6" value="4" id="cat34">
                            <label class="form-check-label" for="cat34">4</label>
                            <input class="form-check-input" type="radio" name="question6" value="5" id="cat35">
                            <label class="form-check-label" for="cat35">5</label>
                          </div>
                        </div>
                      </div>
                      <!-- Question 7 -->
                      <div class="col-md-12">
                        <div class="form-check-group">
                          <div class="label">
                            <label class="form-check-label">ข้าพเจ้านอนหลับสนิท</label>
                          </div>
                          <div class="radio-group">
                            <input class="form-check-input" type="radio" name="question7" value="0" id="cat36">
                            <label class="form-check-label" for="cat36">0</label>
                            <input class="form-check-input" type="radio" name="question7" value="1" id="cat37">
                            <label class="form-check-label" for="cat37">1</label>
                            <input class="form-check-input" type="radio" name="question7" value="2" id="cat38">
                            <label class="form-check-label" for="cat38">2</label>
                            <input class="form-check-input" type="radio" name="question7" value="3" id="cat39">
                            <label class="form-check-label" for="cat39">3</label>
                            <input class="form-check-input" type="radio" name="question7" value="4" id="cat40">
                            <label class="form-check-label" for="cat40">4</label>
                            <input class="form-check-input" type="radio" name="question7" value="5" id="cat41">
                            <label class="form-check-label" for="cat41">5</label>
                          </div>
                        </div>
                      </div>
                      <!-- Question 8 -->
                      <div class="col-md-12">
                        <div class="form-check-group">
                          <div class="label">
                            <label class="form-check-label">ข้าพเจ้ารู้สึกกระฉับกระเฉงอย่างมาก</label>
                          </div>
                          <div class="radio-group">
                            <input class="form-check-input" type="radio" name="question8" value="0" id="cat42">
                            <label class="form-check-label" for="cat42">0</label>
                            <input class="form-check-input" type="radio" name="question8" value="1" id="cat43">
                            <label class="form-check-label" for="cat43">1</label>
                            <input class="form-check-input" type="radio" name="question8" value="2" id="cat44">
                            <label class="form-check-label" for="cat44">2</label>
                            <input class="form-check-input" type="radio" name="question8" value="3" id="cat45">
                            <label class="form-check-label" for="cat45">3</label>
                            <input class="form-check-input" type="radio" name="question8" value="4" id="cat46">
                            <label class="form-check-label" for="cat46">4</label>
                            <input class="form-check-input" type="radio" name="question8" value="5" id="cat47">
                            <label class="form-check-label" for="cat47">5</label>
                          </div>
                        </div>
                      </div>


                      <button class="btn btn-primary mt-3" type="button" onclick="submitCAT1()">แปลผล</button>
                    </div>
                  </div>
                </div>
              </div>
          </form>
          <!-- Modal A -->
          <!-- Modal -->
          <div class="modal fade" id="modalA" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
            aria-labelledby="modalALabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h1 class="modal-title fs-5" id="staticBackdropLabel">คุณอยู่ในระดับ <span style="color: green;">A</span></h1>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <img src="../image/a.jpg" width="50%" alt="">

                  <p> - mMRC : คะแนน 0-1 <br>
                    - CAT : คะแนน < 10 <br>
                      - ความเสี่ยงต่อการกำเริบของโรค : มาก</p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-primary" data-bs-dismiss="modal">สำเร็จ</button>
                  <!-- <button type="button" class="btn btn-primary" id="confirmBtn">สำเร็จ</button> -->
                </div>
              </div>
            </div>
          </div>
          <div class="modal fade" id="modalB" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
            aria-labelledby="modalBLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h1 class="modal-title fs-5" id="staticBackdropLabel">คุณอยู่ในระดับ <span style="color: yellow;">B</span></h1>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <img src="../image/b.jpg" width="50%" alt="">
                  <hr>
                  <p>- mMRC : คะแนน ≥ 2 <br>
                    - CAT : คะแนน ≥ 10 <br>
                    - ความเสี่ยงต่อการกำเริบของโรค : น้อย

                  </p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-primary" data-bs-dismiss="modal">สำเร็จ</button>
                  <!-- <button type="button" class="btn btn-primary" id="confirmBtn">สำเร็จ</button> -->
                </div>
              </div>
            </div>
          </div>
          <div class="modal fade" id="modalE" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
            aria-labelledby="modalELabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h1 class="modal-title fs-5" id="staticBackdropLabel">คุณอยู่ในระดับ <span style="color: red;">E</span></h1>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <img src="../image/e.jpg" width="50%" alt="">
                  <hr>
                  <p>- mMRC : คะแนน 3-4 <br>
                    - CAT : คะแนน > 30 <br>
                    - ความเสี่ยงต่อการกำเริบของโรค : น้อย
                  </p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-primary" data-bs-dismiss="modal">สำเร็จ</button>
                  <!-- <button type="button" class="btn btn-primary" id="confirmBtn">สำเร็จ</button> -->
                </div>
              </div>
            </div>
          </div>

          <!-- เพิ่ม jQuery -->
          <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

          <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>

          <script>
                      function submitCAT1() {
                          const CAT1_Data = {};
                      
                          // คำถามและชื่อของตัวเลือก
                          const questions = [
                              { text: 'ข้าพเจ้าไม่เคยมีอาการไอ', name: 'question1' },
                              { text: 'ข้าพเจ้าไม่มีเสมหะในปอดเลย', name: 'question2' },
                              { text: 'ข้าพเจ้าไม่รู้สึกแน่นหน้าอกเลย', name: 'question3' },
                              { text: 'เมื่อข้าพเจ้าเดินขึ้นเนินหรือขึ้นบันไดหนึ่งชั้น ข้าพเจ้ายังคงหายใจได้คล่อง', name: 'question4' },
                              { text: 'ข้าพเจ้าทำกิจกรรมต่างๆที่บ้านได้โดยไม่จำกัด', name: 'question5' },
                              { text: 'ข้าพเจ้ามีความมั่นใจที่จะออกไปนอกบ้านทั้งๆที่ ปอดข้าพเจ้ามีปัญหา', name: 'question6' },
                              { text: 'ข้าพเจ้านอนหลับสนิท', name: 'question7' },
                              { text: 'ข้าพเจ้ารู้สึกกระฉับกระเฉงอย่างมาก', name: 'question8' }
                          ];
                      
                          // เก็บคำตอบที่เลือก
                          questions.forEach(question => {
                              const selectedAnswer = document.querySelector(`input[name="${question.name}"]:checked`);
                              if (selectedAnswer) {
                                  CAT1_Data[question.name] = {
                                      value: selectedAnswer.value,
                                      detail: question.text
                                  };
                              }
                          });
                      
                          localStorage.setItem('CAT1_Data', JSON.stringify(CAT1_Data));
                          console.log('Stored CAT1_Data:', JSON.parse(localStorage.getItem('CAT1_Data')));
                      
                          // แปลงข้อมูลจาก URL
                          const urlParams = new URLSearchParams(window.location.search);
                          // const idP = urlParams.get('Id_P');
                          const data = urlParams.get('data');
                      
                          let parsedData = {};
                          if (data) {
                              try {
                                  parsedData = JSON.parse(decodeURIComponent(data));
                              } catch (error) {
                                  console.error('Error parsing data:', error);
                              }
                          }
                      
                          // console.log('Id_P:', idP);
                          console.log('Data:', parsedData);
                      
                          function calculateMMRCCategoryScore(parsedData) {
                              let score = 0;
                              if (parsedData['1Qmmrc'] === 'ใช่') score += 1;
                              if (parsedData['2Qmmrc'] === 'ใช่') score += 1;
                              if (parsedData['3Qmmrc'] === 'ใช่') score += 1;
                              if (parsedData['4Qmmrc'] === 'ใช่') score += 1;
                              if (parsedData['5Qmmrc'] === 'ใช่') score += 1;
                              return score;
                          }
                      
                          function calculateCATScore(CAT1_Data) {
                              return Object.values(CAT1_Data).reduce((sum, item) => sum + parseInt(item.value, 10), 0);
                          }
                      
                          // คำนวณคะแนน
                          const mMRC_Score = calculateMMRCCategoryScore(parsedData);
                          const CAT_Score = calculateCATScore(CAT1_Data);
                      
                          // แสดงค่า mMRC_Score และ CAT_Score ใน console
                          console.log('mMRC Score:', mMRC_Score);
                          console.log('CAT Score:', CAT_Score);
                      
                          // แสดง modal ที่เหมาะสม
                          if (mMRC_Score >= 3 && mMRC_Score <= 5 && CAT_Score >= 30) {
                              $('#modalE').modal('show');
                          } else if (mMRC_Score >= 2 && CAT_Score >= 10 && CAT_Score <= 29) {
                              $('#modalB').modal('show');
                          } else if (mMRC_Score >= 0 && mMRC_Score <= 1 && CAT_Score < 10) {
                              $('#modalA').modal('show');
                          } else {
                              $('#defaultModal').modal('show');
                          }
                      
                          // เมื่อ modal ปิด ให้ทำการเปลี่ยนเส้นทาง
                          $('#modalA, #modalB, #modalE, #defaultModal').on('hidden.bs.modal', function () {
                              redirectToSelectForm();
                          });
                      
                          // ฟังก์ชันสำหรับการเปลี่ยนเส้นทางเมื่อกดปุ่ม "สำเร็จ"
                          function redirectToSelectForm() {
                              // const encodedId = localStorage.getItem('userId');  // ดึงค่า id จาก localStorage หรือแหล่งข้อมูลอื่นๆ
                              const name = localStorage.getItem('userName');    // ดึงค่า name จาก localStorage หรือแหล่งข้อมูลอื่นๆ
                              const surname = localStorage.getItem('userSurname');  // ดึงค่า surname จาก localStorage หรือแหล่งข้อมูลอื่นๆ
                      
                              // เปลี่ยนเส้นทางไปยัง URL ใหม่
                              window.location.href = `../selectForm.html?name=${encodeURIComponent(name)}&surname=${encodeURIComponent(surname)}`;
                          }
                      }

          </script>


          <!-- SweetAlert2 JS -->
          <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
          <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>
